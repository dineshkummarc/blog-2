<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<title>JavaScript Diff</title>
<style type="text/css">
body{font-family:trebuchet ms,sans-serif}
textarea{width:40%;height:200px}
ins,del{text-decoration:none}
ins{background:#cfc}
del{background:#fcc}
#out{font-family:monospace;font-size:11px;border:solid 1px #ccc;padding:2px}
</style>
</head><body>
<div id="canvas">
<h1>JavaScript Diff</h1>
<textarea id="one">
body{font-family:'trebuchet ms',verdana,sans-serif;font-size:13px}
html,body,h1,h2,h3,h4,p,pre{margin:0;padding:0}
img{border:0}
body{margin:0;background:#ddd;color:#000}
#canvas{width:780px;margin:auto;padding:10px;background:#fff;border:solid 1px #666;border-top:0;border-bottom:0}
#user{float:right;font-size:.85em;clear:both}
#identity{height:110px;position:relative}
#identity img{float:left;padding-right:10px}
#identity p{margin-bottom:4px}
#identity a#home{font-size:1.5em;color:#E06018;text-decoration:none}
#identity a#home:hover{text-decoration:underline}
#main{overflow-y:auto;float:left;width:560px;min-height:400px;margin-bottom:10px;clear:both}
#main p,pre{margin-bottom:10px;clear:both}
h1{font-size:1.4em;margin-bottom:10px;border-bottom:solid 2px #E06018;padding:5px 0;color:#666}
h2{font-size:1em;margin-bottom:5px;color:#E06018}
h4{margin:2px;font-size:1em;background:#ddd}
ul{margin-top:0;margin-bottom:5px}
acronym{border-bottom:dotted 1px #00f}
img.inline{float:left;margin-right:10px}
p.code{font-family:monospace;font-size:11px;background:#FAF4B8;padding:10px;width:538px;overflow-x:auto}
code{color:#00f}
.comment{color:#099}
#nav{float:left;width:200px;margin-left:20px}
#nav div{border:solid 1px #E06018;margin-bottom:10px}
#nav p{margin-bottom:5px}
a.external{background:url(icon_popup.gif) right no-repeat;padding-right:15px}
a.mailto{background:url(icon_mail.gif) center right no-repeat;padding-right:18px}
table.stripe{border-top:solid 1px #ccf;margin-bottom:10px}
td{border-bottom:solid 1px #ccf;vertical-align:top}
.stripe tr.odd{background:#eef}
.niceform{background:#eee;border:solid 1px #E06018;padding:5px}
.niceform ul{margin:5px 0;padding:0}
.niceform li{list-style:none;clear:both}
label{display:block;float:left;width:70px}
input{width:300px}
input.check{width:auto}
textarea{display:block;width:540px;height:100px;font-family:arial,helvetica,sans-serif;}
#comments ol{margin:0;padding:0}
#comments li{list-style:none;;border-top:solid 1px #E06018;padding:5px}
#comments p{margin:0 0 0 5px;padding:0 0 0 5px;border-left:solid 5px #ddd}
.tagcloud ul{margin:0;padding:5px}
.tagcloud li{list-style:none;display:inline;font-size:11px}
.tag1{font-size:1em;color:#9696FF}
.tag2{font-size:1.2em;color:#7878FF}
.tag3{font-size:1.4em;color:#5A5AFF}
.tag4{font-size:1.6em;color:#3C3CFF}
.tag5{font-size:1.8em;color:#1E1EFF}
.tag6{font-size:2em;color:#0000FF}
</textarea>
<textarea id="two">
body{font-family:'trebuchet ms',verdana,sans-serif;font-size:13px}
html,body,h1,h2,h3,h4,p,pre{margin:0;padding:0}
img{border:0}
body{margin:0;background:#ddd;color:#000}
#canvas{width:780px;margin:auto;padding:10px;background:#fff;border:solid 1px #666;border-top:0;border-bottom:0}
#topnav{margin:0;padding:0 20px;list-style:none;height:18px;background:#fc0;border-bottom:solid 1px #333}
#topnav li,#topnav a{display:block;float:left}
#topnav a{text-decoration:none;color:#333;padding:2px 10px}
#topnav a:hover{background:#FFED80}
#topnav a.on{background:#E26300;color:#fff}
#topnav a.on:hover{background:#FC8934}
#user{float:right;font-size:.85em;clear:both}
#identity{height:110px;position:relative}
#identity img{float:left;padding-right:10px}
#identity p{margin-bottom:4px}
#identity a#home{font-size:1.5em;color:#ff0000;text-decoration:none}
#identity a#home:hover{text-decoration:underline}
#main{overflow-y:auto;float:left;width:560px;min-height:400px;margin-bottom:10px;clear:both}
#main p,pre{margin-bottom:10px;clear:both}
h1{font-size:1.4em;margin-bottom:10px;border-bottom:solid 2px #E06018;padding:5px 0;color:#666}
h2{font-size:1em;margin-bottom:5px;color:#E06018}
h4{margin:2px;font-size:1em;background:#ddd}
ul{margin-top:0;margin-bottom:5px}
acronym{border-bottom:dotted 1px #00f}
img.inline{float:left;margin-right:10px}
#viewbody div{margin-bottom:10px;border-bottom:solid 1px #ccc;padding-bottom:5px}
#viewbody strong{display:block;margin-bottom:5px}
#viewbody strong a{font-size:1.2em;color:#E06018;text-decoration:none}
#viewbody strong a:hover{text-decoration:underline}
p.code{font-family:monospace;font-size:11px;background:#FAF4B8;padding:10px;width:538px;overflow-x:auto}
code{color:#00f}
.comment{color:#090}
#nav{float:left;width:200px;margin-left:20px}
#nav div{border:solid 1px #E06018;margin-bottom:10px}
#nav p{margin-bottom:5px}
a.external{background:url(icon_popup.gif) right no-repeat;padding-right:15px}
a.mailto{background:url(icon_mail.gif) center right no-repeat;padding-right:18px}
table.stripe{border-top:solid 1px #ccf;margin-bottom:10px}
td{border-bottom:solid 1px #ccf;vertical-align:top}
.stripe tr.odd{background:#eef}
.niceform{background:#ddd;border:solid 1px #E06018;padding:5px}
.niceform ul{margin:5px 0;padding:0}
.niceform li{list-style:none;clear:both}
label{display:block;float:left;width:70px}
input{width:300px}
input.check{width:auto}
textarea{display:block;width:540px;height:100px;font-family:arial,helvetica,sans-serif;}
#newcomment p{text-align:center;margin:0}
p.buttons{text-align:center}
p.buttons input{width:80px}
h3{font-size:1em;margin-bottom:5px}
#newcomment{margin:0}
#comments ol{margin:0;padding:0}
#comments li{list-style:none;;border-top:solid 1px #E06018;padding:5px}
#comments p{margin:0 0 0 5px;padding:0 0 0 5px;border-left:solid 5px #ddd}
</textarea><br />
<button onclick="test()">Calculate Diff</button> (<ins>Green: added</ins> - <del>red: deleted</del>).
<div id="out">This space makes the difference.</div>
</div>
<script type="text/javascript">//<![CDATA[
var $=function(a){return document.getElementById(a)}
function test(){
	var o=diffString(escape($('one').value),escape($('two').value))
	o=o.replace(/\r/gm,'<br />')
	//o=o.replace(/\n/gm,'<br />\n')
	o=o.replace(/\t/gm,'&nbsp;&nbsp;&nbsp;&nbsp;')
	$('out').innerHTML=o
}
/* from:  http://ejohn.org/projects/javascript-diff-algorithm/ */
function escape(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function diffString(o,n){
	o=o.replace(/\s+$/,'');n=n.replace(/\s+$/,'')
	var out=diff(o==''?[]:o.split(/\s+/),n==''?[]:n.split(/\s+/)),str='',i,x=null,pre
	var oSpace=o.match(/\s+/g),nSpace=n.match(/\s+/g)
	if(oSpace==x)oSpace=['\n'];else oSpace.push('\n')
	if(nSpace==x)nSpace=['\n'];else nSpace.push('\n')
	if(out.n.length==0){for(i=0;i<out.o.length;i++)str+='<del>'+escape(out.o[i])+oSpace[i]+'</del>'}
	else{
		if(out.n[0].text==x){for(n=0;n<out.o.length && out.o[n].text==x;n++)str+='<del>'+escape(out.o[n])+oSpace[n]+'</del>'}
		for(i=0;i<out.n.length;i++){
			if(out.n[i].text==x)str+='<ins>'+escape(out.n[i])+nSpace[i]+"</ins>"
			else{
				pre=''
				for(n=out.n[i].row+1;n<out.o.length && out.o[n].text==x;n++){
					pre+='<del>'+escape(out.o[n])+oSpace[n]+"</del>"
				}
				str+=" "+out.n[i].text+nSpace[i]+pre
			}
		}
	}
	return str
}
function diff(o,n){
	var ns={},os={},i,x=null
	for(i=0;i<n.length;i++){if(ns[n[i]]==x)ns[n[i]]={rows:[],o:x};ns[n[i]].rows.push(i)}
	for(i=0;i<o.length;i++){if(os[o[i]]==x)os[o[i]]={rows:[],n:x};os[o[i]].rows.push(i)}
	for(i in ns){
		if(ns[i].rows.length==1 && typeof(os[i])!="undefined" && os[i].rows.length==1){
			n[ns[i].rows[0]]={text:n[ns[i].rows[0]],row:os[i].rows[0]}
			o[os[i].rows[0]]={text:o[os[i].rows[0]],row:ns[i].rows[0]}
		}
	}
	for(i=0;i<n.length-1;i++){
		if(n[i].text!=x && n[i+1].text==x && n[i].row+1<o.length && o[n[i].row+1].text==x && 
		n[i+1]==o[n[i].row+1]){
			n[i+1]={text:n[i+1],row:n[i].row+1}
			o[n[i].row+1]={text:o[n[i].row+1],row:i+1}
		}
	}
	for(i=n.length-1;i>0;i--){
		if(n[i].text!=x && n[i-1].text==x && n[i].row>0 && o[n[i].row-1].text==x && 
		n[i-1]==o[n[i].row-1]){
			n[i-1]={text:n[i-1],row:n[i].row-1}
			o[n[i].row-1]={text:o[n[i].row-1],row:i-1}
		}
	}
	return {o:o,n:n}
}
//]]></script>
</body></html>
